{"version":3,"file":"data-privacy-compliance.umd.js","sources":["../src/lib/cookie.js","../src/frameworks/base.js","../src/frameworks/ccpa_on_chorus.js","../src/frameworks/ccpa_from_us_privacy_string.js","../src/frameworks/us_privacy_string_and_api_generator.js","../src/frameworks/index.js","../src/privacy_compliance.js","../src/index.js"],"sourcesContent":["/**\n * Gets all the cookies as a Map\n *\n * @returns Map of cookie values\n */\nfunction getAllCookies() {\n  return new Map(document.cookie.split(';').map(cookie => cookie.trim().split('=')));\n}\n\n/**\n * Checks if cookie exists\n *\n * @param {String} name name of cookie\n * @return {Boolean} true of cookie is present\n */\nfunction hasCookie(name) {\n  return getAllCookies().has(name);\n}\n\n/**\n * Gets the cookie value\n *\n * @param {String} name name of cookie\n * @return {String} the value of the cookie\n */\nfunction getCookie(name) {\n  return getAllCookies().get(name);\n}\n\nmodule.exports = {\n  getAllCookies,\n  hasCookie,\n  getCookie,\n};\n","class FrameworkBase {\n  constructor() {\n    this.privacyComplianceInstance = null;\n  }\n\n  static isAutoLoaded() {\n    return true;\n  }\n\n  name() {\n    return 'FrameworkBase';\n  }\n\n  isApplicable() {\n    return true;\n  }\n\n  useConfig(someConfigs = {}) {}\n\n  supportedCapabilities() {\n    return [];\n  }\n\n  supportedGenerators() {\n    return [];\n  }\n\n  canAnswerCapability(capability) {\n    return this.supportedCapabilities().includes(capability);\n  }\n\n  canGenerate(ability) {\n    return this.supportedGenerators().includes(ability);\n  }\n\n  setPrivacyComplianceInstance(pc) {\n    this.privacyComplianceInstance = pc;\n  }\n\n  log(...args) {\n    this.privacyComplianceInstance && this.privacyComplianceInstance.log(`[${this.name()}]`, ...args);\n  }\n}\n\nmodule.exports = FrameworkBase;\n","const Cookie = require('../lib/cookie');\nconst FrameworkBase = require('./base');\n\nclass CcpaOnChorus extends FrameworkBase {\n  name() {\n    return 'CcpaOnChorus';\n  }\n\n  isApplicable() {\n    return !!window && !!window.Chorus;\n  }\n\n  supportedCapabilities() {\n    return ['canUsePersonalInformationForTargeting', 'hasBeenNotifiedOfRights', 'isLSPACoveredTransaction'];\n  }\n\n  canUsePersonalInformationForTargeting() {\n    return !Cookie.hasCookie('_chorus_ccpa_consent_donotsell');\n  }\n\n  hasBeenNotifiedOfRights() {\n    // see https://github.com/voxmedia/sbn/commit/ce74ab006c89afe799afffa2a31137454d9e5bb3\n    return Cookie.hasCookie('_chorus_ccpa_consent');\n  }\n\n  isLSPACoveredTransaction() {\n    return true;\n  }\n}\n\nmodule.exports = CcpaOnChorus;\n","const FrameworkBase = require('./base');\n\n/**\n * Implements usprivacy string framework\n * for more information on the US Privacy string see:\n * https://github.com/InteractiveAdvertisingBureau/USPrivacy/blob/master/CCPA/US%20Privacy%20String.md#us-privacy-string-format\n */\nclass CCPAFromUSPrivacyString extends FrameworkBase {\n  constructor() {\n    super();\n    this.usPrivacyString = '';\n  }\n\n  name() {\n    return 'CCPAFromUSPrivacyString';\n  }\n\n  useConfig({ usp }) {\n    if (usp) {\n      this.usPrivacyString = ('' + usp).toUpperCase();\n    }\n  }\n\n  isApplicable() {\n    return !!this.usPrivacyString;\n  }\n\n  supportedCapabilities() {\n    return ['canUsePersonalInformationForTargeting', 'hasBeenNotifiedOfRights', 'isLSPACoveredTransaction'];\n  }\n\n  canUsePersonalInformationForTargeting() {\n    return this.consentStringAllowsPersonalDataSale();\n  }\n\n  hasBeenNotifiedOfRights() {\n    return this.consentStringAcknowledgesUserHasBeenNotifiedOfRights();\n  }\n\n  consentStringAllowsPersonalDataSale() {\n    if (!this.supportedUsPrivacyStringVersion()) return true;\n    if (!this.consentStringAcknowledgesUserHasBeenNotifiedOfRights()) return true;\n    return this.usPrivacyString[2] !== 'Y';\n  }\n\n  isLSPACoveredTransaction() {\n    return this.supportedUsPrivacyStringVersion() && this.usPrivacyString[3] === 'Y';\n  }\n\n  consentStringAcknowledgesUserHasBeenNotifiedOfRights() {\n    return this.supportedUsPrivacyStringVersion() && this.usPrivacyString[1] === 'Y';\n  }\n\n  supportedUsPrivacyStringVersion() {\n    return this.usPrivacyString.length === 4 && this.usPrivacyString[0] === '1';\n  }\n}\n\nmodule.exports = CCPAFromUSPrivacyString;\n","const FrameworkBase = require('./base');\n\nconst US_PRIVACY_API_VERSION = 1;\n\n/**\n * Implements usprivacy string framework\n * for more information on the US Privacy string see:\n * https://github.com/InteractiveAdvertisingBureau/USPrivacy/blob/master/CCPA/US%20Privacy%20String.md#us-privacy-string-format\n */\nclass UsPrivacyStringAndAPIGenerator extends FrameworkBase {\n  constructor() {\n    super();\n    this.window = window;\n    this.document = document;\n  }\n\n  name() {\n    return 'UsPrivacyStringAndAPIGenerator';\n  }\n\n  supportedGenerators() {\n    return ['usPrivacyString', 'installPrivacyAPI'];\n  }\n\n  useConfig({ window, document }) {\n    this.window = window;\n    this.document = document;\n  }\n\n  usPrivacyString(callback = () => {}) {\n    callback(this.buildUsPrivacyString(), this);\n  }\n\n  installPrivacyAPI(callback = () => {}) {\n    this.window.__uspapi = this.handleUSPrivacyAPI.bind(this);\n    this.createUspapiFrame();\n    callback(true);\n  }\n\n  // Private methods ---------\n  buildUsPrivacyString() {\n    let usp = '' + US_PRIVACY_API_VERSION;\n    usp += this.privacyComplianceInstance.hasBeenNotifiedOfRights() ? 'Y' : 'N';\n    usp += this.privacyComplianceInstance.canUsePersonalInformationForTargeting() ? 'N' : 'Y';\n    usp += this.privacyComplianceInstance.isLSPACoveredTransaction() ? 'Y' : 'N';\n    return usp;\n  }\n\n  handleUSPrivacyAPI(command, version, callback) {\n    if (typeof callback !== 'function') {\n      throw `__uspapi: Expected ${callback} to be a function, received a ${typeof callback}`;\n    }\n\n    let canSuccessfullyAnswer = true;\n    let usPrivacyDataString = `${US_PRIVACY_API_VERSION}---`;\n\n    if (version !== US_PRIVACY_API_VERSION) {\n      console.error(`__uspapi: Only able to handle version 1`);\n      canSuccessfullyAnswer = false;\n    }\n\n    switch (command) {\n      case 'getUSPData':\n        usPrivacyDataString = this.buildUsPrivacyString();\n        break;\n      default:\n        canSuccessfullyAnswer = false;\n        console.error(`__uspapi: Unable to handle command '${command}'`);\n    }\n\n    this.log(\n      `${canSuccessfullyAnswer ? 'Successfully' : 'Unsuccessfully'} handled CCPA privacy request ${usPrivacyDataString}`\n    );\n\n    callback(\n      {\n        uspString: usPrivacyDataString,\n        version: US_PRIVACY_API_VERSION,\n      },\n      canSuccessfullyAnswer\n    );\n  }\n\n  /**\n   * Creates a top level iframe used to proxy messages between\n   * frames and this implementation of the CCPA Compliance Framework\n   *\n   * It works by:\n   *   1. Creating a specially named iframe\n   *   2. Setting up an event listener on this frame\n   *   3. This listener will proxy \"__uspapiCall\" messages to handleUSPrivacyAPI\n   *   4. and post the message back to the sending frame.\n   */\n  createUspapiFrame() {\n    this.log('Creating __uspapiLocator iframe');\n\n    const frame = this.document.createElement('iframe');\n    frame.setAttribute('name', '__uspapiLocator');\n    frame.style.display = 'none';\n\n    if (this.document.readyState === 'loading') {\n      this.document.addEventListener('DOMContentLoaded', () => {\n        this.document.body.appendChild(frame);\n        this.setupIframeMessageProxyOn(frame);\n      });\n    } else {\n      this.document.body.appendChild(frame);\n      this.setupIframeMessageProxyOn(frame);\n    }\n  }\n\n  /**\n   * Will setup listener proxy on the iframe which... accomplish 2-4 from above\n   *\n   *   2. Setting up an event listener on this frame\n   *   3. This listener will proxy \"__uspapiCall\" messages to handleUSPrivacyAPI\n   *   4. and post the message back to the sending frame.\n   *\n   * @param {DOMElement} frame the iframe to setup the listener on\n   */\n  setupIframeMessageProxyOn(frame) {\n    frame.contentWindow.addEventListener('message', event => {\n      const messageData = event.data;\n\n      if (messageData && messageData.__uspapiCall) {\n        this.log('__uspapiLocator responding to message request');\n\n        const uspapiCallParameters = messageData.__uspapiCall;\n        const targetSource = event.source || window.top;\n        const targetOrigin = event.origin || '*';\n\n        this.handleUSPrivacyAPI(\n          uspapiCallParameters.command,\n          uspapiCallParameters.version,\n          (uspData, wasSuccessful) => {\n            targetSource.postMessage(\n              {\n                __uspapiReturn: {\n                  returnValue: uspData,\n                  success: wasSuccessful,\n                  callId: uspapiCallParameters.callId,\n                },\n              },\n              targetOrigin\n            );\n          }\n        );\n      }\n    });\n  }\n}\n\nmodule.exports = UsPrivacyStringAndAPIGenerator;\n","const CcpaOnChorus = require('./ccpa_on_chorus');\nconst CcpaFromUsPrivacyString = require('./ccpa_from_us_privacy_string');\nconst UsPrivacyStringAndAPIGenerator = require('./us_privacy_string_and_api_generator');\n\nmodule.exports = [CcpaOnChorus, CcpaFromUsPrivacyString, UsPrivacyStringAndAPIGenerator];\n","const frameworks = require('./frameworks');\n\n/**\n * The public Privacy Compliance class, which is exported as a singleton\n *\n * Responsible for managing frameworks and proxying requests to related\n * frameworks.\n *\n * Note: This uses Proxy() to support introspection of method calls\n * to make it look like this class has a lot more functions\n * than it really does\n */\nclass PrivacyCompliance {\n  constructor() {\n    this.frameworks = [];\n    this.supportedCapabilities = new Set();\n    this.supportedGenerators = new Set();\n    this.logEntries = [];\n    this.logger = (...args) => {\n      this.logEntries.push(args);\n    };\n  }\n\n  /**\n   * useConfig is a convenient way to pass configuration values to all frameworks.\n   * When a useConfig is called, every loaded framework will have their own\n   * useConfig methods called.\n   *\n   * The ideal pattern is to use keys to type the configs, for example:\n   * PrivacyCompliance.useConfig({\n   *   usp: \"1TFT\"\n   * })\n   * Which could signal to any listening capabiltiy-frameworks to use the new\n   * US Privacy String\n   *\n   * @param {Object} someConfigs any config to share with all frameworks\n   */\n  useConfig(someConfigs) {\n    this.frameworks.forEach(f => f.useConfig(someConfigs));\n  }\n\n  /**\n   * Allows this libraries internal logs to be accessible to including libraries.\n   * The default is to also insert any missed logs. Because this is setup as a singleton,\n   * it is easy to miss the initial setup logs, that happened, before a logger was setup.\n   *\n   * @param {Function} logFunction to be called everytime a new log entry is generated\n   * @param {Boolean} relogMissedEntries when true will relog missed entries from before the logger was wired up\n   */\n  useLogger(logFunction, relogMissedEntries = true) {\n    this.logger = logFunction;\n    if (relogMissedEntries) {\n      this.logEntries.forEach(entry => this.log(...entry));\n    }\n  }\n\n  addFramework(frameworkInstance) {\n    this.log('Adding new framework: ', frameworkInstance.name());\n    frameworkInstance.setPrivacyComplianceInstance(privacyComplianceSingleton);\n    this.frameworks.push(frameworkInstance);\n    frameworkInstance.supportedCapabilities().forEach(c => this.supportedCapabilities.add(c));\n    frameworkInstance.supportedGenerators().forEach(c => this.supportedGenerators.add(c));\n  }\n\n  /**\n   * Checks if a given Capability (as a string) can be answered by the loaded\n   * frameworks.\n   *\n   * Caution: not all frameworks will be applicable and able to\n   * answer this capability for all environments.\n   *\n   * @param {String} capability the method name of the capability\n   * @returns Boolean true if the capability can be answered\n   */\n  hasFrameworkLoadedToAnswerCapability(capability) {\n    return this.supportedCapabilities.has(capability);\n  }\n\n  canGenerate(ability) {\n    return this.supportedGenerators.has(ability);\n  }\n\n  /**\n   * Returns a list of applicable frameworks for this environment.\n   */\n  applicableFrameworks() {\n    return this.frameworks.filter(f => f.isApplicable());\n  }\n\n  log(...args) {\n    this.logger(...args);\n  }\n\n  get Generator() {\n    return new Proxy(this, {\n      get: (privacyComplianceInstance, property) => {\n        return privacyComplianceInstance.proxyToFrameworkGenerators(property);\n      },\n    });\n  }\n\n  // For use with testing only\n  reset() {\n    this.frameworks = [];\n    this.supportedCapabilities = new Set();\n    this.supportedGenerators = new Set();\n  }\n\n  /**\n   * This method will take a string, translate it into a method and call it\n   * on the added frameworks. If all applicable frameworks support this capability\n   * then it will return true, if not it will be false.\n   *\n   * @param {String} methodName the name of methods to call on the base frameworks\n   * @return Boolean if all the frameworks permit this\n   */\n  proxyToFrameworks(methodName) {\n    try {\n      return this.frameworks\n        .filter(f => f.isApplicable())\n        .filter(f => f.canAnswerCapability(methodName))\n        .map(f => {\n          this.log(f.name() + ' answering: ' + methodName);\n          return f;\n        })\n        .map(f => f[methodName].call(f))\n        .every(result => !!result);\n    } catch (e) {\n      console.error(`There was an error calling ${methodName} - ${e}`);\n    }\n  }\n\n  /**\n   * This method will take a string, translate it into a method and call it\n   * on the added frameworks. If all applicable frameworks support this generator\n   * then it will be called, with the given passback.\n   *\n   * Note this is a little more complex than capabilities, because like capabilities\n   * multiple frameworks can be called for this generator, and there is no convenient way\n   * to collect those responses, so instead it takes a callback that will be executed for\n   * every generator run.\n   *\n   * @param {String} methodName the name of methods to call on the base frameworks\n   * @returns {Function} the function to execute, with callback of the generators response\n   */\n  proxyToFrameworkGenerators(methodName) {\n    if (this.canGenerate(methodName)) {\n      return (callback = () => {}) => {\n        try {\n          this.frameworks\n            .filter(f => f.isApplicable())\n            .filter(f => f.canGenerate(methodName))\n            .forEach(f => f[methodName].call(f, callback));\n        } catch (e) {\n          console.error(`There was an error calling ${methodName} - ${e}`);\n        }\n      };\n    } else {\n      this.throwUnsupportedError(methodName);\n    }\n  }\n\n  throwUnsupportedError(method) {\n    throw new TypeError(\n      `Can not call '${method}'. It is not found in the loaded frameworks. Supported capabilities: ${Array.from(\n        this.supportedCapabilities\n      ).join(', ')}`\n    );\n  }\n\n  /**\n   * This uses a modern Proxy() object to support arbitrary missing methods\n   * which allows the frameworks to declare their own capability methods without\n   * needing to add those to this class.\n   */\n\n  applyProxy() {\n    return new Proxy(this, {\n      get: (privacyComplianceInstance, property) => {\n        if (Reflect.has(privacyComplianceInstance, property)) {\n          return Reflect.get(privacyComplianceInstance, property);\n        } else if (privacyComplianceInstance.hasFrameworkLoadedToAnswerCapability(property)) {\n          return () => {\n            return privacyComplianceInstance.proxyToFrameworks(property);\n          };\n        } else {\n          privacyComplianceInstance.throwUnsupportedError(property);\n        }\n      },\n    });\n  }\n}\n\nconst privacyComplianceSingleton = new PrivacyCompliance().applyProxy();\n\n// Autoload all of the auto-loaded frameworks\nframeworks\n  .filter(f => f.isAutoLoaded())\n  .forEach(f => {\n    privacyComplianceSingleton.addFramework(new f());\n  });\n\nmodule.exports = privacyComplianceSingleton;\n","const PrivacyCompliance = require('./privacy_compliance');\n\nmodule.exports = {\n  PrivacyCompliance,\n};\n"],"names":["getAllCookies","Map","document","cookie","split","map","trim","hasCookie","name","has","getCookie","get","FrameworkBase","privacyComplianceInstance","capability","supportedCapabilities","includes","ability","supportedGenerators","pc","args","log","CcpaOnChorus","window","Chorus","Cookie","CCPAFromUSPrivacyString","usPrivacyString","usp","toUpperCase","consentStringAllowsPersonalDataSale","consentStringAcknowledgesUserHasBeenNotifiedOfRights","supportedUsPrivacyStringVersion","length","US_PRIVACY_API_VERSION","UsPrivacyStringAndAPIGenerator","callback","buildUsPrivacyString","__uspapi","handleUSPrivacyAPI","bind","createUspapiFrame","hasBeenNotifiedOfRights","canUsePersonalInformationForTargeting","isLSPACoveredTransaction","command","version","canSuccessfullyAnswer","usPrivacyDataString","console","error","uspString","frame","createElement","setAttribute","style","display","readyState","addEventListener","body","appendChild","setupIframeMessageProxyOn","contentWindow","event","messageData","data","__uspapiCall","uspapiCallParameters","targetSource","source","top","targetOrigin","origin","uspData","wasSuccessful","postMessage","__uspapiReturn","returnValue","success","callId","CcpaFromUsPrivacyString","PrivacyCompliance","frameworks","Set","logEntries","logger","push","someConfigs","forEach","f","useConfig","logFunction","relogMissedEntries","entry","frameworkInstance","setPrivacyComplianceInstance","privacyComplianceSingleton","c","add","filter","isApplicable","methodName","canAnswerCapability","call","every","result","e","canGenerate","throwUnsupportedError","method","TypeError","Array","from","join","Proxy","property","Reflect","hasFrameworkLoadedToAnswerCapability","proxyToFrameworks","proxyToFrameworkGenerators","applyProxy","isAutoLoaded","addFramework"],"mappings":"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"}